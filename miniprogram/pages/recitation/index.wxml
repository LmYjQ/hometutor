<view class="container">
  <!-- ä½œä¸šä¿¡æ¯ -->
  <view class="assignment-info">
    <view class="class-tag">{{assignment.class_name}}</view>
    <view class="question">{{assignment.question_title}}</view>
    <view class="deadline">æˆªæ­¢æ—¶é—´: {{assignment.deadlineText}}</view>
  </view>

  <!-- å‚è€ƒæ–‡æœ¬ -->
  <view class="reference-section" wx:if="{{assignment.reference_text}}">
    <view class="section-title">å‚è€ƒæ–‡æœ¬</view>
    <view class="reference-text">{{assignment.reference_text}}</view>
  </view>

  <!-- å½•åˆ¶åŒºåŸŸ -->
  <view class="record-section">
    <view class="camera-preview" wx:if="{{isRecording || videoPath}}">
      <video
        class="video-preview"
        src="{{videoPath}}"
        wx:if="{{videoPath}}"
        controls
      ></video>
      <camera
        wx:if="{{!videoPath}}"
        device-position="back"
        flash="off"
        binderror="onCameraError"
        style="width: 100%; height: 400rpx; border-radius: 16rpx;"
      ></camera>
    </view>

    <view class="record-placeholder" wx:else bindtap="startRecord">
      <text class="placeholder-icon">ğŸ¥</text>
      <text class="placeholder-text">ç‚¹å‡»å¼€å§‹å½•åˆ¶</text>
      <text class="placeholder-hint">å»ºè®®å½•åˆ¶15-60ç§’</text>
    </view>

    <!-- å½•åˆ¶æ§åˆ¶ -->
    <view class="record-controls" wx:if="{{!videoPath}}">
      <button
        class="record-btn {{isRecording ? 'recording' : ''}}"
        bindtap="toggleRecord"
      >
        <text class="record-icon">{{isRecording ? 'â¹' : 'âº'}}</text>
        <text class="record-time" wx:if="{{isRecording}}">{{recordTime}}s</text>
      </button>
    </view>

    <!-- é‡æ–°å½•åˆ¶ -->
    <view class="re-record" wx:if="{{videoPath}}">
      <button class="re-record-btn" bindtap="reRecord">é‡æ–°å½•åˆ¶</button>
    </view>
  </view>

  <!-- ä¸Šä¼ å’Œæäº¤ -->
  <view class="submit-section" wx:if="{{videoPath}}">
    <view class="video-info">
      <text class="info-text">è§†é¢‘å·²å‡†å¤‡å¥½</text>
      <text class="file-size">å¤§å°: {{fileSizeText}}</text>
    </view>

    <button
      class="submit-btn"
      bindtap="submitRecitation"
      loading="{{uploading || analyzing}}"
      disabled="{{uploading || analyzing}}"
    >
      <text wx:if="{{!uploading && !analyzing}}">æäº¤èƒŒè¯µ</text>
      <text wx:if="{{uploading}}">ä¸Šä¼ ä¸­...</text>
      <text wx:if="{{analyzing}}">AIè¯„åˆ†ä¸­...</text>
    </button>

    <view class="progress-section" wx:if="{{analyzing}}">
      <progress percent="{{progress}}" stroke-width="6" activeColor="#667eea" backgroundColor="#f0f0f0" active />
      <text class="progress-text">{{progressText}}</text>
    </view>
  </view>

  <!-- å†å²æäº¤è®°å½• -->
  <view class="history-section" wx:if="{{historySubmissions.length > 0}}">
    <view class="section-title">å†å²æäº¤</view>
    <view class="history-list">
      <view class="history-item" wx:for="{{historySubmissions}}" wx:key="_id" bindtap="viewResult" data-id="{{item._id}}">
        <view class="history-time">{{item.created_atText}}</view>
        <view class="history-score">
          <text class="score">{{item.score}}åˆ†</text>
        </view>
        <view class="history-status {{item.status}}">
          {{item.status === 'graded' ? 'å·²è¯„åˆ†' : 'è¯„åˆ†ä¸­'}}
        </view>
      </view>
    </view>
  </view>
</view>
