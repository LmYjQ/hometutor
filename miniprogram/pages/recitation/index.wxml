<view class="container">
  <!-- ä½œä¸šä¿¡æ¯ -->
  <view class="assignment-info">
    <view class="class-tag">{{assignment.class_name}}</view>
    <view class="question">{{assignment.question_title}}</view>
    <view class="deadline">æˆªæ­¢æ—¶é—´: {{assignment.deadlineText}}</view>
  </view>

  <!-- å½•åˆ¶åŒºåŸŸ -->
  <view class="record-section">
    <!-- è§†é¢‘é¢„è§ˆï¼ˆå½•åˆ¶å®Œæˆåæ˜¾ç¤ºï¼‰ -->
    <view class="video-container" wx:if="{{videoPath}}">
      <video class="video-preview" src="{{videoPath}}" controls></video>
      <view class="video-overlay">
        <view class="re-record-btn" bindtap="reRecord">é‡æ–°å½•åˆ¶</view>
      </view>
    </view>

    <!-- æ‘„åƒå¤´é¢„è§ˆå’Œå½•åˆ¶ -->
    <view class="camera-container" wx:else>
      <camera
        device-position="{{cameraPosition}}"
        flash="off"
        binderror="onCameraError"
        style="width: 100%; height: 400rpx; border-radius: 16rpx;"
      ></camera>
      <view class="camera-controls" wx:if="{{!isRecording}}">
        <view class="switch-camera-btn" bindtap="switchCamera">
          <text>ğŸ”„ ç¿»è½¬</text>
        </view>
      </view>
    </view>

    <!-- å½•åˆ¶æ§åˆ¶ -->
    <view class="record-controls" wx:if="{{!videoPath}}">
      <view
        class="record-btn {{isRecording ? 'recording' : ''}}"
        bindtap="toggleRecord"
      >
        <text class="record-icon">{{isRecording ? 'â¹' : 'âº'}}</text>
        <text class="record-time" wx:if="{{isRecording}}">{{recordTime}}s</text>
        <text class="record-label">{{isRecording ? 'åœæ­¢' : 'å½•åˆ¶'}}</text>
      </view>

      <!-- ç›¸å†Œé€‰æ‹© -->
      <view class="album-btn" wx:if="{{!isRecording}}" bindtap="chooseFromAlbum">ä»ç›¸å†Œé€‰æ‹©è§†é¢‘</view>
    </view>
  </view>

  <!-- ä¸Šä¼ å’Œæäº¤ -->
  <view class="submit-section" wx:if="{{videoPath}}">
    <view class="video-info">
      <text class="info-text">è§†é¢‘å·²å‡†å¤‡å¥½</text>
      <text class="file-size">å¤§å°: {{fileSizeText}}</text>
    </view>

    <button
      class="submit-btn"
      bindtap="submitRecitation"
      loading="{{uploading || analyzing}}"
      disabled="{{uploading || analyzing || remainingSubmissions === 0}}"
    >
      <text wx:if="{{uploading}}">ä¸Šä¼ ä¸­...</text>
      <text wx:elif="{{analyzing}}">AIè¯„åˆ†ä¸­...</text>
      <text wx:elif="{{remainingSubmissions === 0}}">å·²è¾¾æäº¤æ¬¡æ•°ä¸Šé™</text>
      <text wx:else>æäº¤èƒŒè¯µ</text>
    </button>

    <view class="progress-section" wx:if="{{analyzing}}">
      <progress percent="{{progress}}" stroke-width="6" activeColor="#667eea" backgroundColor="#f0f0f0" active />
      <text class="progress-text">{{progressText}}</text>
    </view>
  </view>

  <!-- å†å²æäº¤è®°å½• -->
  <view class="history-section" wx:if="{{historySubmissions.length > 0}}">
    <view class="section-title">å†å²æäº¤</view>
    <view class="history-list">
      <view class="history-item" wx:for="{{historySubmissions}}" wx:key="_id" bindtap="viewResult" data-id="{{item._id}}">
        <view class="history-time">{{item.created_atText}}</view>
        <view class="history-score">
          <text class="score">{{item.score}}åˆ†</text>
        </view>
        <view class="history-status {{item.status}}">
          {{item.status === 'graded' ? 'å·²è¯„åˆ†' : 'è¯„åˆ†ä¸­'}}
        </view>
      </view>
    </view>
  </view>
</view>
