<view class="container">
  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨è·å–è¯„åˆ†ç»“æœ...</text>
  </view>

  <!-- å¾…è¯„åˆ†çŠ¶æ€ -->
  <view class="pending" wx:if="{{!loading && isPending && submission}}">
    <view class="pending-icon">â³</view>
    <text class="pending-text">è¯„åˆ†ä¸­ï¼Œè¯·ç¨å€™...</text>
    <text class="pending-hint">AIæ­£åœ¨åˆ†ææ‚¨çš„èƒŒè¯µå†…å®¹ï¼Œé¢„è®¡éœ€è¦1-3åˆ†é’Ÿ</text>
  </view>

  <!-- å¤±è´¥çŠ¶æ€ -->
  <view class="failed" wx:if="{{!loading && isFailed && submission}}">
    <view class="failed-icon">âŒ</view>
    <text class="failed-title">è¯„åˆ†å¤±è´¥</text>
    <text class="failed-error">{{error}}</text>
    <button class="retry-btn" bindtap="goToRecitation">é‡æ–°æäº¤</button>
  </view>

  <!-- è¯„åˆ†ç»“æœ -->
  <view class="result" wx:if="{{!loading && submission && !isFailed && !isPending}}">
    <!-- åˆ†æ•°å¡ç‰‡ -->
    <view class="score-card">
      <view class="score-ring">
        <view class="score-value" style="color: {{scoreColor}}">{{submission.score}}</view>
        <view class="score-unit">åˆ†</view>
      </view>
      <view class="score-label">AIæ™ºèƒ½è¯„åˆ†</view>
    </view>

    <!-- ä½œä¸šä¿¡æ¯ -->
    <view class="assignment-info">
      <view class="class-tag">{{submission.class_name}}</view>
      <view class="question">{{submission.question_title}}</view>
    </view>

    <!-- è¯„ä»·å†…å®¹ -->
    <view class="evaluation-section">
      <view class="section-title">AIè¯„ä»·</view>

      <!-- é—æ¼ç‚¹ -->
      <view class="missing-points" wx:if="{{submission.evaluation.missing_points && submission.evaluation.missing_points.length > 0}}">
        <view class="point-header">
          <text class="point-icon">âŒ</text>
          <text class="point-title">å¯èƒ½é—æ¼çš„å†…å®¹</text>
        </view>
        <view class="point-list">
          <view class="point-item" wx:for="{{submission.evaluation.missing_points}}" wx:key="index">
            <text class="point-num">{{index + 1}}.</text>
            <text class="point-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- è¯„è¯­ -->
      <view class="comment" wx:if="{{submission.evaluation.comment}}">
        <view class="comment-header">
          <text class="comment-icon">ğŸ’¬</text>
          <text class="comment-title">ç»¼åˆè¯„è¯­</text>
        </view>
        <view class="comment-text">{{submission.evaluation.comment}}</view>
      </view>
    </view>

    <!-- åŸæ–‡å¯¹ç…§ -->
    <view class="text-comparison">
      <view class="section-title">åŸæ–‡å¯¹ç…§</view>

      <view class="text-section">
        <view class="text-label">èƒŒè¯µè¯†åˆ«ç»“æœï¼š</view>
        <view class="text-content">{{submission.audio_text || 'æœªèƒ½è¯†åˆ«åˆ°è¯­éŸ³'}}</view>
      </view>

      <view class="text-section" wx:if="{{submission.reference_text}}">
        <view class="text-label">æ ‡å‡†ç­”æ¡ˆï¼š</view>
        <view class="text-content">{{submission.reference_text}}</view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="action-btn primary" bindtap="goToRecitation">å†ç»ƒä¸€æ¬¡</button>
      <button class="action-btn secondary" bindtap="goBack">è¿”å›ä½œä¸šåˆ—è¡¨</button>
    </view>
  </view>

  <!-- é”™è¯¯çŠ¶æ€ -->
  <view class="error" wx:if="{{!loading && error}}">
    <text class="error-icon">âš ï¸</text>
    <text class="error-text">{{error}}</text>
    <button class="retry-btn" bindtap="loadResult">é‡æ–°åŠ è½½</button>
  </view>
</view>
